<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Checkout | Arcity</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>

<header>
  <nav class="navbar">
    <div class="logo">
      <img src="images/logo.png" alt="Arcity Logo" />
    </div>
    <ul class="nav-links">
      <li><a href="index.html">Home</a></li>
      <li><a href="cart.html">Cart <span id="cart-count" style="font-weight:800;"></span></a></li>
    </ul>
  </nav>
</header>

<section class="shop-page">
  <h1>Checkout</h1>

  <div class="product-card" style="max-width:900px;margin:0 auto;">
    <h2>Order Summary</h2>
    <div id="order-summary" style="margin-top:12px;"></div>
    <div id="order-total" style="margin-top:14px;font-weight:900;"></div>
  </div>

  <div class="product-card" style="max-width:900px;margin:18px auto;">
    <h2>Your Details</h2>

    <!-- âœ… REPLACE the action URL with your Formspree endpoint -->
    <form id="order-form" action="https://formspree.io/f/xnjvpknj" method="POST">

      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;margin-top:12px;">
        <div>
          <label style="font-weight:800;font-size:12px;">Full Name</label>
          <input name="name" required class="limited-search" style="color:#111;background:#fafafa;border:1px solid #e6e6e6;" />
        </div>

        <div>
          <label style="font-weight:800;font-size:12px;">Phone</label>
          <input name="phone" required class="limited-search" style="color:#111;background:#fafafa;border:1px solid #e6e6e6;" />
        </div>

        <div>
          <label style="font-weight:800;font-size:12px;">Email</label>
          <input name="email" type="email" required class="limited-search" style="color:#111;background:#fafafa;border:1px solid #e6e6e6;" />
        </div>
      </div>

      <div style="margin-top:12px;">
        <label style="font-weight:800;font-size:12px;">Delivery Address</label>
        <textarea name="address" required rows="4" class="limited-search"
          style="color:#111;background:#fafafa;border:1px solid #e6e6e6;resize:vertical;"></textarea>
      </div>

      <!-- Hidden fields (we fill these using JS) -->
      <input type="hidden" name="order_text" id="order_text" />
      <input type="hidden" name="order_json" id="order_json" />
      <input type="hidden" name="order_html" id="order_html" />

      <button class="add-to-cart" type="submit" style="margin-top:14px;">
        Submit Order
      </button>

      <p style="margin-top:10px;color:#666;font-size:12px;">
        Your email will receive the order details including image links/paths.
      </p>
    </form>
  </div>
</section>

<script src="js/cart.js"></script>
  <script>
  // === Arcity checkout image URL fix ===
  const CART_STORAGE_KEY = "arcity_cart_v1";
  const SITE_BASE_URL = "https://arcityonlineshopping.github.io/arcity";

  function getCart() {
    try {
      return JSON.parse(localStorage.getItem(CART_STORAGE_KEY)) || [];
    } catch {
      return [];
    }
  }

  function formatMoney(n) {
    return "R" + Number(n).toLocaleString("en-ZA");
  }

  function makeImageUrl(path) {
    if (!path) return "";
    if (path.startsWith("http")) return path;
    if (path.startsWith("/")) return SITE_BASE_URL + path;
    return SITE_BASE_URL + "/" + path;
  }

  function renderCheckout() {
    const cart = getCart();
    const summary = document.getElementById("order-summary");
    const totalEl = document.getElementById("order-total");
    const orderText = document.getElementById("order_text");
    const orderJson = document.getElementById("order_json");

    if (!cart.length) {
      summary.innerHTML = "<p>Your cart is empty.</p>";
      orderText.value = "Cart empty";
      orderJson.value = "{}";
      return;
    }

    let total = 0;

    summary.innerHTML = cart.map(item => {
      const imgURL = makeImageUrl(item.img);
      const subtotal = item.price * item.qty;
      total += subtotal;

      return `
        <div style="display:flex;gap:12px;padding:10px 0;border-bottom:1px solid #eee;">
          <img src="${imgURL}" style="width:60px;height:60px;border-radius:10px;object-fit:cover;">
          <div>
            <strong>${item.name}</strong><br>
            Size: ${item.size}<br>
            Qty: ${item.qty}<br>
            Image: ${imgURL}
          </div>
          <div style="margin-left:auto;font-weight:900;">
            ${formatMoney(subtotal)}
          </div>
        </div>
      `;
    }).join("");

    totalEl.textContent = "Total: " + formatMoney(total);

    const textLines = cart.map((item, i) => {
      return `Item ${i + 1}: ${item.name}
Size: ${item.size}
Qty: ${item.qty}
Price: ${formatMoney(item.price)}
Image: ${makeImageUrl(item.img)}`;
    });

    orderText.value =
      "ARCITY ORDER\n\n" +
      textLines.join("\n\n") +
      "\n\nTOTAL: " + formatMoney(total);

    orderJson.value = JSON.stringify({
      items: cart.map(item => ({
        ...item,
        img: makeImageUrl(item.img)
      })),
      total
    }, null, 2);
  }

  window.addEventListener("DOMContentLoaded", renderCheckout);
</script>
  <script>
  const CART_STORAGE_KEY = "arcity_cart_v1";
  const SITE_BASE_URL = "https://arcityonlineshopping.github.io/arcity";

  function getCart() {
    try {
      return JSON.parse(localStorage.getItem(CART_STORAGE_KEY)) || [];
    } catch {
      return [];
    }
  }

  function formatMoney(n) {
    return "R" + Number(n).toLocaleString("en-ZA");
  }

  function makeImageUrl(path) {
    if (!path) return "";
    if (path.startsWith("http")) return path;
    if (path.startsWith("/")) return SITE_BASE_URL + path;
    return SITE_BASE_URL + "/" + path;
  }

  function renderCheckout() {
    const cart = getCart();

    const orderText = document.getElementById("order_text");
    const orderJson = document.getElementById("order_json");
    const orderHtml = document.getElementById("order_html");

    if (!cart.length) {
      orderText.value = "Cart empty";
      orderJson.value = "{}";
      orderHtml.value = "<p>Cart empty</p>";
      return;
    }

    let total = 0;

    const htmlCards = cart.map(item => {
      const imgURL = makeImageUrl(item.img);
      const subtotal = item.price * item.qty;
      total += subtotal;

      return `
        <div style="border:1px solid #ddd;padding:12px;margin-bottom:10px;">
          <strong>${item.name}</strong><br>
          Size: ${item.size} | Qty: ${item.qty}<br>
          Price: ${formatMoney(item.price)}<br>
          <img src="${imgURL}" style="width:160px;border-radius:10px;margin-top:6px;">
          <div><a href="${imgURL}">${imgURL}</a></div>
        </div>
      `;
    }).join("");

    orderText.value = cart.map(item =>
      `${item.name} | Size ${item.size} | Qty ${item.qty} | Image: ${makeImageUrl(item.img)}`
    ).join("\n");

    orderJson.value = JSON.stringify(cart, null, 2);

    orderHtml.value = `
      <h2>ARCITY ORDER</h2>
      ${htmlCards}
      <strong>Total: ${formatMoney(total)}</strong>
    `;
  }

  window.addEventListener("DOMContentLoaded", renderCheckout);
</script>


<script src="js/checkout.js"></script>
</body>
</html>



